import io.vertx.core.http.HttpMethod
import io.vertx.core.Vertx
import io.vertx.ext.auth.jwt.JWTAuth
import top.dteam.dgate.utils.*

apiGateway {
    port = 7004
    login = "/login"
    cors {
        allowedOriginPattern = "*"
        allowedMethods = [HttpMethod.GET, HttpMethod.POST, HttpMethod.DELETE]
        allowedHeaders = ['content-type', 'authorization']
        allowCredentials = true
    }
    urls {
        "/login" {
            required = ['phone', 'password']
            methods = [HttpMethod.GET, HttpMethod.POST]
            expected {
                statusCode = 200
                payload = {
                    JWTAuth jwtAuth = Utils.createAuthProvider(Vertx.vertx())
                    JWTTokenGenerator tokenGenerator = new JWTTokenGenerator(jwtAuth)
                    [
                        "id"       : "1",
                        "nickname" : "王大锤",
                        "role" : 'WRZ',
                        "avatar": 'assets/img/avatar_1.png',
                        token      : tokenGenerator.token(["sub": "13572209183", "name": "foxgem", "role": "normal", id: "1"], 52100000)
                    ]
                }
            }
        }

        "/upcoming-tasks" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                        orders: [
                            [
                                id: 1,
                                billNo: "131233123123",               
                                area: "街道1",                 
                                enterpirse: "东南西北有限公司",           
                                examiner: "王大锤",             
                                inspectionDate: "2017-07-O1",       
                                dealineDate: "2017-08-30",          
                                insPosition: "合肥市解放路1号",          
                                insDesc: "检查卫生",              
                                insQuestion: "卫生脏乱差",          
                                proPosal: "打扫卫生",             
                                replyDate: "2017-08-29",            
                                replyDesc: "已打扫干净",            
                                status: "DFK"   
                            ],
                            [
                                id: 2,
                                billNo: "999999999",               
                                area: "街道2",                 
                                enterpirse: "东南西北有限公司",           
                                examiner: "王大锤",             
                                inspectionDate: "2017-07-11",       
                                dealineDate: "2017-08-30",          
                                insPosition: "合肥市解放路1号",          
                                insDesc: "检查卫生",              
                                insQuestion: "卫生脏乱差",          
                                proPosal: "打扫卫生",             
                                replyDate: "2017-08-29",            
                                replyDesc: "已打扫干净",            
                                status: "DFK",   

                            ]
                        ],
                        waybills: [
                            [
                                id: 1,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0408",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-01-30 15:09",
                                status: "待审核"
                            ],
                            [
                                id: 2,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0409",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-05-30 19:09",
                                status: "已驳回"
                            ],
                            [
                                id: 3,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0410",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-03-30 11:09",
                                status: "已完成"
                            ]
                        ]
                    ]
                }
            }
        }

        "/rectification-orders" {
            required = ["status", "max", "offset"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                        orders: [
                            [
                                id: 1,
                                billNo: "131233123123",               
                                area: "街道1",                 
                                enterpirse: "东南西北有限公司",           
                                examiner: "王大锤",             
                                inspectionDate: "2017-07-O1",       
                                dealineDate: "2017-08-30",          
                                insPosition: "合肥市解放路1号",          
                                insDesc: "检查卫生",              
                                insQuestion: "卫生脏乱差",          
                                proPosal: "打扫卫生",             
                                replyDate: "2017-08-29",            
                                replyDesc: "已打扫干净",            
                                status: "DFK"   
                            ],
                            [
                                id: 2,
                                billNo: "999999999",               
                                area: "街道2",                 
                                enterpirse: "东南西北有限公司",           
                                examiner: "王大锤",             
                                inspectionDate: "2017-07-11",       
                                dealineDate: "2017-08-30",          
                                insPosition: "合肥市解放路1号",          
                                insDesc: "检查卫生",              
                                insQuestion: "卫生脏乱差",          
                                proPosal: "打扫卫生",             
                                replyDate: "2017-08-29",            
                                replyDesc: "已打扫干净",            
                                status: "DFK",   

                            ]
                        ],
                        total: 15
                    ]
                }
            }
        }

        "/rectification-orders/:id" {
            required = ["id"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                       data: [
                            id: 2,
                            billNo: "999999999",               
                            area: "街道2",                 
                            enterpirse: "东南西北有限公司",           
                            examiner: "王大锤",             
                            inspectionDate: "2017-07-11",       
                            dealineDate: "2017-08-30",          
                            insPosition: "合肥市解放路1号",          
                            insDesc: "检查卫生",              
                            insQuestion: "卫生脏乱差",          
                            proPosal: "打扫卫生",          
                            status: "DFK",
                       ] 
                    ]
                }
            }
        }

        "/companys" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                        companys : [
                            [
                                id: 1,
                                name: "公司1"
                            ],
                            [
                                id: 2,
                                name: "公司2"
                            ],
                            [
                                id: 3,
                                name: "公司4"
                            ]
                        ]
                    ]
                }
            }
        }

        "/companys/:id/vehicles" {
            required = ["id"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                        vehicles: [
                            [
                                id: 1,
                                vehicleNo: "皖12345"
                            ],
                            [
                                id: 2,
                                vehicleNo: "皖23312"
                            ],
                            [
                                id: 3,
                                vehicleNo: "皖98898"
                            ],
                        ]
                    ]
                }
            }
        }

        "/rectification-orders/:id/feedback" {
            required = ["id", "feedback"]
            expected {
                post {
                    statusCode = 200
                }
            }
        }

        "/rectification-orders/:id/confirm" {
            required = ["id"]
            expected {
                post {
                    statusCode = 200
                }
            }
        }

        "/waybills" {
            required = ["status", "offset", "max"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                        waybills: [
                            [
                                id: 1,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0408",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-01-30 15:09",
                                status: "待审核"
                            ],
                            [
                                id: 2,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0409",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-05-30 19:09",
                                status: "已驳回"
                            ],
                            [
                                id: 3,
                                ownerName: "合肥市海联仓储运输有限公司",
                                vehicleNo: "E-P0410",
                                departArea: "安徽省合肥市高新区",
                                arriveArea: "陕西省西安市碑林区",
                                departTime: "2017-03-30 11:09",
                                status: "已完成"
                            ]
                        ],
                        total: 10
                    ]
                }
            }
        }

        "/vehicles" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                        vehicles: [
                            [
                                id: 1,
                                vehicleNo: "皖A-12345",
                                frameNo: "13213213213123",
                                ratifiedPayload: "8000",
                                color: "蓝",
                                type: "普通货车",
                                size: "4000mm*3000mm*2800mm"
                            ],
                            [
                                id: 2,
                                vehicleNo: "皖A-88888",
                                frameNo: "67789777977777",
                                ratifiedPayload: "9000",
                                color: "红",
                                type: "半挂",
                                size: "6000mm*3500mm*3200mm"
                            ]
                        ]
                    ]
                }
            }
        }

        "/drivers" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                        drivers : [
                            [
                                id: 1,
                                name: "张三",
                                certificateNo: "13213123213213",
                                phone: "13013321443"
                            ],
                            [
                                id: 2,
                                name: "李四",
                                certificateNo: "889898989898898",
                                phone: "18912345678"
                            ]
                        ]
                    ]
                }
            }
        }

        "/escorts" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                        escorts : [
                            [
                                id: 1,
                                name: "张三",
                                certificateNo: "13213123213213",
                                phone: "13013321443"
                            ],
                            [
                                id: 2,
                                name: "李四",
                                certificateNo: "889898989898898",
                                phone: "18912345678"
                            ]
                        ]
                    ]
                }
            }
        }

        "/consignCompanys" {
            expected {
                get {
                    statusCode = 200
                    payload = [
                       consignCompanys: [
                           [
                               id: 1,
                               name: "林德电子特种气体(合肥)"
                           ],
                           [
                               id: 2,
                               name: "陕西煤炭集团"
                           ]
                       ] 
                    ]
                }
            }
        }

        "/ways" {
            required = ["departArea", "arriveArea"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                        ways: [
                            [
                                id: 1,
                                name: "途径1"
                            ],
                            [
                                id: 2,
                                name: "途径2"
                            ]
                        ]
                    ]
                }
            }
        }
        
        "/create-freight-waybill" {
            required = ["vehicleId", "emergencyPlan", "price", "mile" , "amount", "loadedType", "fullLoaded", "departTime", "backTime", "consignCompany", "departArea", "arriveArea", "wayId", "driverId" , "escortId"]
            expected {
                post {
                    statusCode = 200
                }
            }
        }

        "/search-track" {
            required = ["query", "startDate" ,"endDate"]
            expected {
                get {
                    statusCode = 200
                    payload = [
                        points:  [
                            [
                                'dateStr': '2017-06-30 07:36:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.35566,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 350,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:37:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.35666,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 320,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:38:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.35766,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 0,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 1
                            ], [
                                'dateStr': '2017-06-30 07:39:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.35816,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 10,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 1
                            ], [
                                'dateStr': '2017-06-30 07:40:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.35966,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 30,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:41:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.36166,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 100,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:42:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.36267,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 350,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:43:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.36467,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 350,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:44:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.36568,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 350,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:45:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.36667,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 350,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 0
                            ], [
                                'dateStr': '2017-06-30 07:46:11',
                                'plateColor': 2,
                                'plateNo': '皖A35898',
                                'posEncrypt': 0,
                                'geoPoint': '116.37168,39.93218',
                                'gpsSpeed': 60,
                                'totalMileage': 1,
                                'recSpeed': 60,
                                'direction': 100,
                                'altitude': 0,
                                'vehicleState': 3,
                                'alarmState': 1
                            ]
                        ]
                    ]
                }
            }
        }
    }
}